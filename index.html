<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Administrativo - Guarda Municipal</title>
<style>
/* ====== ESTILOS ====== */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; }

/* LOGIN */
.login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
.login-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
.login-header { text-align: center; margin-bottom: 30px; }
.login-header h1 { color: #1e3c72; font-size: 24px; margin-bottom: 10px; }
.login-header p { color: #666; font-size: 14px; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
.form-group input, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: border 0.3s; }
.form-group input:focus, select:focus { outline: none; border-color: #1e3c72; }
.btn { width: 100%; background: #1e3c72; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; }
.btn:hover { background: #2a5298; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(30, 60, 114, 0.3); }
.error-msg { background: #fee; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; display: none; }

/* SISTEMA PRINCIPAL */
.main-container { display: none; max-width: 1400px; margin: 0 auto; padding: 20px; }
.header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
.header h1 { color: #1e3c72; font-size: 22px; }
.user-info { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
.badge { background: #1e3c72; color: white; padding: 8px 15px; border-radius: 20px; font-size: 13px; font-weight: 500; }
.badge-admin { background: #dc3545; }
.btn-logout { background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; }
.nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.tab-btn { background: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.tab-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.tab-btn.active { background: #1e3c72; color: white; }
.content-section { display: none; }
.content-section.active { display: block; }
.card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
.card h3 { color: #1e3c72; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; font-size: 18px; }
.item-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #1e3c72; }
.item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
.item-tipo { background: #1e3c72; color: white; padding: 5px 12px; border-radius: 5px; font-size: 12px; font-weight: bold; }
.item-data { color: #666; font-size: 13px; }
.item-titulo { font-weight: 600; font-size: 16px; margin-bottom: 8px; color: #333; }
.item-conteudo { color: #555; line-height: 1.6; }
.btn-actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
.btn-small { padding: 6px 12px; font-size: 13px; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
.btn-edit { background: #ffc107; color: #000; }
.btn-delete { background: #dc3545; color: white; }
.btn-download { background: #28a745; color: white; }
.admin-only { display: none; }
textarea { resize: vertical; min-height: 100px; }
input[type="file"] { padding: 10px; border: 2px dashed #ddd; border-radius: 8px; cursor: pointer; }
.alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
.alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
.empty-state { text-align: center; padding: 40px; color: #999; }
select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; background: white; }
@media (max-width: 768px) { .header { flex-direction: column; text-align: center; } .nav-tabs { flex-direction: column; } .tab-btn { width: 100%; } .item-header { flex-direction: column; align-items: flex-start; } }

/* MODAL EMAIL */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
.modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; }
.modal h2 { color: #1e3c72; margin-bottom: 20px; }
</style>
</head>
<body>

<!-- TELA DE LOGIN -->
<div id="loginScreen" class="login-container">
  <div class="login-box">
    <div class="login-header">
      <h1>üõ°Ô∏è Portal Administrativo</h1>
      <p>Guarda Municipal - Sistema de Gest√£o</p>
    </div>
    <div id="loginError" class="error-msg"></div>
    <form id="loginForm">
      <div class="form-group">
        <label>Usu√°rio</label>
        <input type="text" id="username" placeholder="Digite seu usu√°rio" required>
      </div>
      <div class="form-group">
        <label>Senha</label>
        <input type="password" id="password" placeholder="Digite sua senha" required>
      </div>
      <button type="submit" class="btn">Entrar</button>
    </form>
    <p style="text-align: center; margin-top: 20px; color: #999; font-size: 13px;">Primeiro acesso? Use suas credenciais fornecidas pela administra√ß√£o</p>
  </div>
</div>

<!-- MODAL EMAIL -->
<div id="emailModal" class="modal">
  <div class="modal-content">
    <h2>Bem-vindo! üëã</h2>
    <p style="margin-bottom: 20px;">Para receber notifica√ß√µes, cadastre seu email:</p>
    <form id="emailForm">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="userEmail" placeholder="seu.email@exemplo.com" required>
      </div>
      <button type="submit" class="btn">Confirmar</button>
    </form>
  </div>
</div>

<!-- SISTEMA PRINCIPAL -->
<div id="mainSystem" class="main-container">
  <div class="header">
    <div><h1>üõ°Ô∏è Portal Administrativo GM</h1></div>
    <div class="user-info">
      <span class="badge" id="userBadge"></span>
      <span class="badge badge-admin" id="adminBadge" style="display: none;">ADMINISTRADOR</span>
      <button class="btn-logout" onclick="logout()">Sair</button>
    </div>
  </div>
  <div class="nav-tabs">
    <button class="tab-btn active" onclick="showTab('comunicados', event)">üì¢ Comunicados</button>
    <button class="tab-btn" onclick="showTab('escalas', event)">üìÖ Escalas</button>
    <button class="tab-btn" onclick="showTab('operacoes', event)">üö® Opera√ß√µes</button>
    <button class="tab-btn" onclick="showTab('documentos', event)">üìÅ Documentos</button>
  </div>

  <!-- COMUNICADOS -->
  <div id="comunicados" class="content-section active">
    <div class="card admin-only" id="formComunicado">
      <h3>üìù Novo Comunicado</h3>
      <form onsubmit="addComunicado(event)">
        <div class="form-group">
          <label>Tipo</label>
          <select id="tipoComunicado">
            <option>INFORMATIVO</option>
            <option>URGENTE</option>
            <option>OPERACIONAL</option>
          </select>
        </div>
        <div class="form-group">
          <label>T√≠tulo</label>
          <input type="text" id="tituloComunicado" placeholder="T√≠tulo do comunicado" required>
        </div>
        <div class="form-group">
          <label>Conte√∫do</label>
          <textarea id="conteudoComunicado" placeholder="Escreva o comunicado..." required></textarea>
        </div>
        <button type="submit" class="btn">Publicar e Notificar Todos</button>
      </form>
    </div>
    <div class="card">
      <h3>Todos os Comunicados</h3>
      <div id="listaComunicados"></div>
    </div>
  </div>

  <!-- ESCALAS -->
  <div id="escalas" class="content-section">
    <div class="card admin-only" id="formEscala">
      <h3>üìù Nova Escala</h3>
      <form onsubmit="addEscala(event)">
        <div class="form-group">
          <label>Per√≠odo</label>
          <input type="text" id="periodoEscala" placeholder="Ex: 21/10 a 27/10/2025" required>
        </div>
        <div class="form-group">
          <label>Detalhes da Escala</label>
          <textarea id="conteudoEscala" placeholder="Descreva a escala completa..." required></textarea>
        </div>
        <button type="submit" class="btn">Publicar Escala e Notificar</button>
      </form>
    </div>
    <div class="card">
      <h3>Escalas Publicadas</h3>
      <div id="listaEscalas"></div>
    </div>
  </div>

  <!-- OPERA√á√ïES -->
  <div id="operacoes" class="content-section">
    <div class="card admin-only" id="formOperacao">
      <h3>üìù Nova Opera√ß√£o</h3>
      <form onsubmit="addOperacao(event)">
        <div class="form-group">
          <label>Nome da Opera√ß√£o</label>
          <input type="text" id="nomeOperacao" placeholder="Ex: Opera√ß√£o Centro Seguro" required>
        </div>
        <div class="form-group">
          <label>Data e Hor√°rio</label>
          <input type="datetime-local" id="dataOperacao" required>
        </div>
        <div class="form-group">
          <label>Local</label>
          <input type="text" id="localOperacao" placeholder="Local da opera√ß√£o" required>
        </div>
        <div class="form-group">
          <label>Detalhes</label>
          <textarea id="detalhesOperacao" placeholder="Instru√ß√µes, objetivos, observa√ß√µes..." required></textarea>
        </div>
        <button type="submit" class="btn">Publicar Opera√ß√£o e Notificar</button>
      </form>
    </div>
    <div class="card">
      <h3>Opera√ß√µes Programadas</h3>
      <div id="listaOperacoes"></div>
    </div>
  </div>

  <!-- DOCUMENTOS -->
  <div id="documentos" class="content-section">
    <div class="card admin-only" id="formDocumento">
      <h3>üìù Novo Documento</h3>
      <form onsubmit="addDocumento(event)">
        <div class="form-group">
          <label>Categoria</label>
          <select id="categoriaDoc">
            <option>Procedimento Operacional</option>
            <option>Formul√°rio</option>
            <option>Legisla√ß√£o</option>
            <option>Manual</option>
            <option>Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label>Nome do Documento</label>
          <input type="text" id="nomeDoc" placeholder="Ex: Manual de Abordagem 2025" required>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
          <textarea id="descricaoDoc" placeholder="Breve descri√ß√£o do documento..." required></textarea>
        </div>
        <button type="submit" class="btn">Enviar Documento e Notificar</button>
      </form>
    </div>
    <div class="card">
      <h3>Biblioteca de Documentos</h3>
      <div id="listaDocumentos"></div>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyBVfCbAucFErELqatHP1DgJsAweMR_rzJo",
  authDomain: "sistema-gm-145eb.firebaseapp.com",
  projectId: "sistema-gm-145eb",
  storageBucket: "sistema-gm-145eb.firebasestorage.app",
  messagingSenderId: "1033769343247",
  appId: "1:1033769343247:web:24d6934babf8a4eb65867a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== USU√ÅRIOS TEMPOR√ÅRIOS =====
let currentUser = null;
let usuarios = {
  'comando.marcos': { senha: 'gm2025', nome: 'Comando Marcos', admin: true, email: '' },
  'gm.usuario1': { senha: 'gm2025', nome: 'GM Usu√°rio 1', admin: false, email: '' }
};

// ===== LOGIN =====
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const username = document.getElementById('username').value.toLowerCase();
  const password = document.getElementById('password').value;
  if(usuarios[username] && usuarios[username].senha === password){
    currentUser = { ...usuarios[username], username: username };
    if(!currentUser.email){
      document.getElementById('emailModal').style.display = 'flex';
    } else { showMainSystem(); loadAllData(); }
  } else {
    const errorMsg = document.getElementById('loginError');
    errorMsg.textContent = '‚ùå Usu√°rio ou senha incorretos';
    errorMsg.style.display = 'block';
  }
});

// ===== CAD
